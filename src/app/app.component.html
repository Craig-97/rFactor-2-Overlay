<div class="container__session-banner">
    {{ session?.session | sessionName:'abbreviated'}}
    /
    {{ (session?.endEventTime - session?.currentEventTime) | toMinutes }}
</div>

<div class="container__standings">
    <div class="entry" *ngFor="let entry of standings">
        <div class="entry__position">
            {{ entry.position }}
        </div>
        <div class="entry__colour" [ngStyle]="{'background-color': entry.colour}"></div>
        <div class="entry__driver">
            {{ entry.driverName | driverName:'abbreviated' }}
        </div>
        <div class="entry__gap" *ngIf="entry.bestLapTime !== -1">
            <span *ngIf="entry.position === 1">
                {{ entry.bestLapTime | toMinutes:true }}
            </span>
            <span *ngIf="entry.position > 1">
                +{{ entry.gapToLeader }}
            </span>
        </div>
        <div class="entry__pit" *ngIf="entry.pitting">
            PIT
        </div>
    </div>
</div>

<div class="container__driver" *ngIf="focusedEntry != null">
    <div class="main">
        <div class="driver__position">
            {{ focusedEntry.position }}
        </div>
    
        <div class="driver__info">
            <div class="info__details">
                <p class="details__name">{{ focusedEntry.driverName | driverName:'full'}}</p>
                <p class="details__team">{{ focusedEntry.carClass }}</p>
    
                <div class="details__flag">
                    <img src="https://i.imgur.com/E9TT8to.png">
                </div>
            </div>
            <div class="info__sectors">
                <div class="sectors__row">
                    <div class="sector sector--first">
                        <span class="sector__number">S1</span>
                        <span class="sector__time">
                            <span *ngIf="focusedEntry.lastLapHold; else currentS1">
                                {{ focusedEntry.lastLapHold.lap.sector_1 | toMinutes:true }}
                            </span>
                            <ng-template #currentS1>
                                {{ (focusedEntry.currentSectorTime1 !== -1) ? (focusedEntry.currentSectorTime1 | toMinutes:true) : '' }}
                            </ng-template>
                        </span>
                    </div>
                    <div class="sector sector--second">
                        <span class="sector__number">S2</span>
                        <span class="sector__time">
                            <span *ngIf="focusedEntry.lastLapHold; else currentS2">
                                {{ focusedEntry.lastLapHold.lap.sector_2 | toMinutes:true }}
                            </span>
                            <ng-template #currentS2>
                                {{ (focusedEntry.currentSectorTime2 !== -1) ? (focusedEntry.currentSectorTime2 - focusedEntry.currentSectorTime1 | toMinutes:true) : '' }}
                            </ng-template>
                        </span>
                    </div>
                    <div class="sector sector--third">
                        <span class="sector__number">S3</span>
                        <span class="sector__time" *ngIf="focusedEntry.lastLapHold">
                            {{ focusedEntry.lastLapHold.lap.sector_3 | toMinutes:true }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="secondary">
        <div class="data-key">Best</div>
        <div class="data-value">{{ focusedEntry.bestLapTime | toMinutes:true }}</div>
        <div class="data-key">Gap</div>
        <div class="data-value" [ngSwitch]="focusedEntry.gapEvent">
            <span *ngIf="focusedEntry.lastLapHold; else currentGap">
                {{ focusedEntry.lastLapHold.gap }}
            </span>

            <ng-template #currentGap [ngSwitch]="focusedEntry.gapEvent">
                <span *ngSwitchCase="null">-</span>
                <span *ngSwitchDefault [style.color]="_getSectorColour(focusedEntry.gapEvent.state)">
                    {{ focusedEntry.gapEvent.gap }}
                </span>
            </ng-template>
        </div>
        <div class="data-key">Last Lap</div>
        <div class="data-value">
            {{ (focusedEntry.lastLapTime !== -1) ? (focusedEntry.lastLapTime | toMinutes:true) : 'NA' }}
        </div>
    </div>
</div>

<!-- Testing -->
<div style="position: absolute; right: 40px; top: 40px; background-color: white; font-size: 16px; max-width: 600px;">
    {{ overallBestLap | json }}
    <br><br>
    <span *ngIf="focusedEntry != null">
        {{ focusedEntry | json }}
    </span>
</div>